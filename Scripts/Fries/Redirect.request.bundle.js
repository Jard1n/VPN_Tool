console.log("\uD83D\uDCFA BiliBili: \uD83D\uDD00 Redirect"),console.log("request.bundle.js"),console.log("Version: 0.2.19"),console.log("Date: 2026/1/30 16:40:02"),(()=>{"use strict";let e,t=(()=>{let e=Object.keys(globalThis);switch(!0){case e.includes("$task"):return"Quantumult X";case e.includes("$loon"):return"Loon";case e.includes("$rocket"):return"Shadowrocket";case"u">typeof module:return"Node.js";case e.includes("Egern"):return"Egern";case e.includes("$environment"):if($environment["surge-version"])return"Surge";if($environment["stash-version"])return"Stash";return;default:return}})();class s{static #e=new Map([]);static #t=[];static #s=new Map([]);static clear=()=>{};static count=(e="default")=>{switch(s.#e.has(e)){case!0:s.#e.set(e,s.#e.get(e)+1);break;case!1:s.#e.set(e,0)}s.log(`${e}: ${s.#e.get(e)}`)};static countReset=(e="default")=>{switch(s.#e.has(e)){case!0:s.#e.set(e,0),s.log(`${e}: ${s.#e.get(e)}`);break;case!1:s.warn(`Counter "${e}" doesnâ€™t exist`)}};static debug=(...e)=>{s.#a<4||(e=e.map(e=>`ğŸ…±ï¸ ${e}`),s.log(...e))};static error(...e){if(!(s.#a<1)){switch(t){case"Surge":case"Loon":case"Stash":case"Egern":case"Shadowrocket":case"Quantumult X":default:e=e.map(e=>`âŒ ${e}`);break;case"Node.js":e=e.map(e=>`âŒ ${e.stack}`)}s.log(...e)}}static exception=(...e)=>s.error(...e);static group=e=>s.#t.unshift(e);static groupEnd=()=>s.#t.shift();static info(...e){s.#a<3||(e=e.map(e=>`â„¹ï¸ ${e}`),s.log(...e))}static #a=3;static get logLevel(){switch(s.#a){case 0:return"OFF";case 1:return"ERROR";case 2:return"WARN";case 3:default:return"INFO";case 4:return"DEBUG";case 5:return"ALL"}}static set logLevel(e){switch(typeof e){case"string":e=e.toLowerCase();break;case"number":break;default:e="warn"}switch(e){case 0:case"off":s.#a=0;break;case 1:case"error":s.#a=1;break;case 2:case"warn":case"warning":default:s.#a=2;break;case 3:case"info":s.#a=3;break;case 4:case"debug":s.#a=4;break;case 5:case"all":s.#a=5}}static log=(...e)=>{0!==s.#a&&(e=e.map(e=>{switch(typeof e){case"object":e=JSON.stringify(e);break;case"bigint":case"number":case"boolean":case"string":e=e.toString()}return e}),s.#t.forEach(t=>{(e=e.map(e=>`  ${e}`)).unshift(`â–¼ ${t}:`)}),console.log((e=["",...e]).join("\n")))};static time=(e="default")=>s.#s.set(e,Date.now());static timeEnd=(e="default")=>s.#s.delete(e);static timeLog=(e="default")=>{let t=s.#s.get(e);t?s.log(`${e}: ${Date.now()-t}ms`):s.warn(`Timer "${e}" doesnâ€™t exist`)};static warn(...e){s.#a<2||(e=e.map(e=>`âš ï¸ ${e}`),s.log(...e))}}class a{static escape(e){let t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};return e.replace(/[&<>"']/g,e=>t[e])}static get(e={},t="",s){Array.isArray(t)||(t=a.toPath(t));let r=t.reduce((e,t)=>Object(e)[t],e);return void 0===r?s:r}static omit(e={},t=[]){return Array.isArray(t)||(t=[t.toString()]),t.forEach(t=>a.unset(e,t)),e}static pick(e={},t=[]){return Array.isArray(t)||(t=[t.toString()]),Object.fromEntries(Object.entries(e).filter(([e,s])=>t.includes(e)))}static set(e,t,s){return Array.isArray(t)||(t=a.toPath(t)),t.slice(0,-1).reduce((e,s,a)=>Object(e[s])===e[s]?e[s]:e[s]=/^\d+$/.test(t[a+1])?[]:{},e)[t[t.length-1]]=s,e}static toPath(e){return e.replace(/\[(\d+)\]/g,".$1").split(".").filter(Boolean)}static unescape(e){let t={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"};return e.replace(/&amp;|&lt;|&gt;|&quot;|&#39;/g,e=>t[e])}static unset(e={},t=""){return Array.isArray(t)||(t=a.toPath(t)),t.reduce((e,s,a)=>a===t.length-1?(delete e[s],!0):Object(e)[s],e)}}let r={100:"Continue",101:"Switching Protocols",102:"Processing",103:"Early Hints",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",208:"Already Reported",226:"IM Used",300:"Multiple Choices",301:"Moved Permanently",302:"Found",304:"Not Modified",307:"Temporary Redirect",308:"Permanent Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Content Too Large",414:"URI Too Long",415:"Unsupported Media Type",416:"Range Not Satisfiable",417:"Expectation Failed",418:"I'm a teapot",421:"Misdirected Request",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",425:"Too Early",426:"Upgrade Required",428:"Precondition Required",429:"Too Many Requests",431:"Request Header Fields Too Large",451:"Unavailable For Legal Reasons",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",508:"Loop Detected",510:"Not Extended",511:"Network Authentication Required"};function o(e={}){switch(t){case"Surge":e.policy&&a.set(e,"headers.X-Surge-Policy",e.policy),s.log("\uD83D\uDEA9 æ‰§è¡Œç»“æŸ!",`ğŸ•› ${new Date().getTime()/1e3-$script.startTime} ç§’`),$done(e);break;case"Loon":e.policy&&(e.node=e.policy),s.log("\uD83D\uDEA9 æ‰§è¡Œç»“æŸ!",`ğŸ•› ${(new Date-$script.startTime)/1e3} ç§’`),$done(e);break;case"Stash":e.policy&&a.set(e,"headers.X-Stash-Selected-Proxy",encodeURI(e.policy)),s.log("\uD83D\uDEA9 æ‰§è¡Œç»“æŸ!",`ğŸ•› ${(new Date-$script.startTime)/1e3} ç§’`),$done(e);break;case"Egern":case"Shadowrocket":s.log("\uD83D\uDEA9 æ‰§è¡Œç»“æŸ!"),$done(e);break;case"Quantumult X":switch(e.policy&&a.set(e,"opts.policy",e.policy),typeof(e=a.pick(e,["status","url","headers","body","bodyBytes"])).status){case"number":e.status=`HTTP/1.1 ${e.status} ${r[e.status]}`;break;case"string":case"undefined":break;default:throw TypeError(`${Function.name}: å‚æ•°ç±»å‹é”™è¯¯, status å¿…é¡»ä¸ºæ•°å­—æˆ–å­—ç¬¦ä¸²`)}e.body instanceof ArrayBuffer?(e.bodyBytes=e.body,e.body=void 0):ArrayBuffer.isView(e.body)?(e.bodyBytes=e.body.buffer.slice(e.body.byteOffset,e.body.byteLength+e.body.byteOffset),e.body=void 0):e.body&&(e.bodyBytes=void 0),s.log("\uD83D\uDEA9 æ‰§è¡Œç»“æŸ!"),$done(e);break;default:s.log("\uD83D\uDEA9 æ‰§è¡Œç»“æŸ!"),process.exit(1)}}class i{static data=null;static dataFile="box.dat";static #r=/^@(?<key>[^.]+)(?:\.(?<path>.*))?$/;static getItem(e,s=null){let r=s;if(!0===e.startsWith("@")){let{key:t,path:s}=e.match(i.#r)?.groups;e=t;let o=i.getItem(e,{});"object"!=typeof o&&(o={}),r=a.get(o,s);try{r=JSON.parse(r)}catch(e){}}else{switch(t){case"Surge":case"Loon":case"Stash":case"Egern":case"Shadowrocket":r=$persistentStore.read(e);break;case"Quantumult X":r=$prefs.valueForKey(e);break;case"Node.js":i.data=i.#o(i.dataFile),r=i.data?.[e];break;default:r=i.data?.[e]||null}try{r=JSON.parse(r)}catch(e){}}return r??s}static setItem(e=new String,s=new String){let r=!1;if(s="object"==typeof s?JSON.stringify(s):String(s),!0===e.startsWith("@")){let{key:t,path:o}=e.match(i.#r)?.groups;e=t;let c=i.getItem(e,{});"object"!=typeof c&&(c={}),a.set(c,o,s),r=i.setItem(e,c)}else switch(t){case"Surge":case"Loon":case"Stash":case"Egern":case"Shadowrocket":r=$persistentStore.write(s,e);break;case"Quantumult X":r=$prefs.setValueForKey(s,e);break;case"Node.js":i.data=i.#o(i.dataFile),i.data[e]=s,i.#i(i.dataFile),r=!0;break;default:r=i.data?.[e]||null}return r}static removeItem(e){let s=!1;if(!0===e.startsWith("@")){let{key:t,path:r}=e.match(i.#r)?.groups;e=t;let o=i.getItem(e);"object"!=typeof o&&(o={}),keyValue=a.unset(o,r),s=i.setItem(e,o)}else switch(t){case"Surge":case"Loon":case"Stash":case"Egern":case"Shadowrocket":case"Node.js":default:s=!1;break;case"Quantumult X":s=$prefs.removeValueForKey(e)}return s}static clear(){let e=!1;switch(t){case"Surge":case"Loon":case"Stash":case"Egern":case"Shadowrocket":case"Node.js":default:e=!1;break;case"Quantumult X":e=$prefs.removeAllValues()}return e}static #o=e=>{if("Node.js"!==t)return{};{this.fs=this.fs?this.fs:require("node:fs"),this.path=this.path?this.path:require("node:path");let t=this.path.resolve(e),s=this.path.resolve(process.cwd(),e),a=this.fs.existsSync(t),r=!a&&this.fs.existsSync(s);if(!a&&!r)return{};try{return JSON.parse(this.fs.readFileSync(a?t:s))}catch(e){return{}}}};static #i=(e=this.dataFile)=>{if("Node.js"===t){this.fs=this.fs?this.fs:require("node:fs"),this.path=this.path?this.path:require("node:path");let t=this.path.resolve(e),s=this.path.resolve(process.cwd(),e),a=this.fs.existsSync(t),r=!a&&this.fs.existsSync(s),o=JSON.stringify(this.data);a?this.fs.writeFileSync(t,o):r?this.fs.writeFileSync(s,o):this.fs.writeFileSync(t,o)}}}function c(e){return/^\d+$/.test(e)&&(e=Number.parseInt(e,10)),e}class n{constructor(e){switch(typeof e){case"string":if(0===e.length)break;e.startsWith("?")&&(e=e.slice(1)),e.split("&").map(e=>e.split("=")).forEach(([e,t])=>{this.#c.push(e?decodeURIComponent(e):e),this.#n.push(t?decodeURIComponent(t):t)});break;case"object":if(Array.isArray(e))Object.entries(e).forEach(([e,t])=>{this.#c.push(e),this.#n.push(t)});else if(Symbol.iterator in Object(e))for(const[t,s]of e)this.#c.push(t),this.#n.push(s)}this.#l(this.#c,this.#n)}#h="";#c=[];#n=[];#u(e){return encodeURIComponent(e).replace(/%2C/g,",").replace(/%21/g,"!").replace(/%27/g,"'").replace(/%28/g,"(").replace(/%29/g,")").replace(/%2A/g,"*")}#l(e,t){0===e.length?this.#h="":this.#h=e.map((e,s)=>{switch(typeof t[s]){case"object":return`${this.#u(e)}=${this.#u(JSON.stringify(t[s]))}`;case"boolean":case"number":case"string":return`${this.#u(e)}=${this.#u(t[s])}`;default:return this.#u(e)}}).join("&")}append(e,t){this.#c.push(e),this.#n.push(t),this.#l(this.#c,this.#n)}delete(e,t){for(;this.#c.indexOf(e)>-1;)this.#n.splice(this.#c.indexOf(e),1),this.#c.splice(this.#c.indexOf(e),1);this.#l(this.#c,this.#n)}entries(){return this.#c.map((e,t)=>[e,this.#n[t]])}get(e){return this.#n[this.#c.indexOf(e)]}getAll(e){return this.#n.filter((t,s)=>this.#c[s]===e)}has(e,t){return this.#c.indexOf(e)>-1}keys(){return this.#c}set(e,t){if(-1===this.#c.indexOf(e))this.append(e,t);else{let s=!0,a=[];this.#c=this.#c.filter((r,o)=>r!==e?(a.push(this.#n[o]),!0):!!s&&(s=!1,a.push(t),!0)),this.#n=a,this.#l(this.#c,this.#n)}}sort(){let e=this.entries().sort();this.#c=[],this.#n=[],e.forEach(e=>{this.#c.push(e[0]),this.#n.push(e[1])}),this.#l(this.#c,this.#n)}toString=()=>this.#h;values=()=>this.#n.values()}class l{constructor(e,t){switch(typeof e){case"string":{const s=/^(blob:|file:)?[a-zA-z]+:\/\/.*/.test(e),a=!!t&&/^(blob:|file:)?[a-zA-z]+:\/\/.*/.test(t);if(s)this.href=e;else if(a)this.href=t+e;else throw TypeError('URL string is not valid. If using a relative url, a second argument needs to be passed representing the base URL. Example: new URL("relative/path", "http://www.example.com");');break}case"object":break;default:throw TypeError("Invalid argument type.")}}#p={hash:"",host:"",hostname:"",href:"",password:"",pathname:"",port:NaN,protocol:"",search:"",searchParams:new n(""),username:""};static #d=/^(?<scheme>([^:\/?#]+):)?(?:\/\/(?<authority>[^\/?#]*))?(?<path>[^?#]*)(?<query>\?([^#]*))?(?<hash>#(.*))?$/;static #m=/^(?<authentication>(?<username>[^:]*)(:(?<password>[^@]*))?@)?(?<hostname>[^:]+)(:(?<port>\d+))?$/;get hash(){return this.#p.hash}set hash(e){0!==e.length&&(e.startsWith("#")&&(e=e.slice(1)),this.#p.hash=`#${encodeURIComponent(e)}`)}get host(){return this.port.length>0?`${this.hostname}:${this.port}`:this.hostname}set host(e){[this.hostname,this.port]=e.split(":",2)}get hostname(){return encodeURIComponent(this.#p.hostname)}set hostname(e){this.#p.hostname=e??""}get href(){let e="";return this.username.length>0&&(e+=this.username,this.password.length>0&&(e+=`:${this.password}`),e+="@"),`${this.protocol}//${e}${this.host}${this.pathname}${this.search}${this.hash}`}set href(e){(e.startsWith("blob:")||e.startsWith("file:"))&&(e=e.slice(5));let t=e.match(l.#d);if(!t)throw TypeError("Invalid URL format.");this.protocol=t.groups.scheme??"";let s=t.groups.authority.match(l.#m);this.username=s.groups.username??"",this.password=s.groups.password??"",this.hostname=s.groups.hostname??"",this.port=s.groups.port??"",this.pathname=t.groups.path??"",this.search=t.groups.query??"",this.hash=t.groups.hash??""}get origin(){return`${this.protocol}//${this.host}`}get password(){return encodeURIComponent(this.#p.password)}set password(e){this.username.length>0&&(this.#p.password=e??"")}get pathname(){return`/${this.#p.pathname}`}set pathname(e){(e=`${e}`).startsWith("/")&&(e=e.slice(1)),this.#p.pathname=e}get port(){if(Number.isNaN(this.#p.port))return"";let e=this.#p.port.toString();return"ftp:"===this.protocol&&"21"===e||"http:"===this.protocol&&"80"===e||"https:"===this.protocol&&"443"===e?"":e}set port(e){if(""===e)this.#p.port=NaN;else{let t=Number.parseInt(e,10);t>=0&&t<65535&&(this.#p.port=t)}}get protocol(){return`${this.#p.protocol}:`}set protocol(e){e.endsWith(":")&&(e=e.slice(0,-1)),this.#p.protocol=e}get search(){return(this.#p.search=this.searchParams.toString(),this.#p.search.length>0)?`?${this.#p.search}`:""}set search(e){(e=`${e}`).startsWith("?")&&(e=e.slice(1)),this.#p.search=e,this.#p.searchParams=new n(this.#p.search)}get searchParams(){return this.#p.searchParams}get username(){return encodeURIComponent(this.#p.username)}set username(e){this.#p.username=e??""}static parse=(e,t)=>new l(e,t);toString=()=>this.href;toJSON=()=>JSON.stringify({hash:this.hash,host:this.host,hostname:this.hostname,href:this.href,origin:this.origin,password:this.password,pathname:this.pathname,port:this.port,protocol:this.protocol,search:this.search,searchParams:this.searchParams,username:this.username})}let h={Redirect:{Settings:{Host:{OverseaVideo:"upos-sz-mirrorali.bilivideo.com",BStar:"upos-sz-mirrorali.bilivideo.com",PCDN:"upos-sz-mirrorali.bilivideo.com",MCDN:"proxy-tf-all-ws.bilivideo.com"}}},Default:{Settings:{LogLevel:"WARN"}}},u=new l($request.url);s.info(`url: ${u.toJSON()}`);let p=u.pathname.split("/").filter(Boolean);s.info(`PATHs: ${p}`);let d=($request.headers?.["Content-Type"]??$request.headers?.["content-type"])?.split(";")?.[0];s.info(`FORMAT: ${d}`),(async()=>{let{Settings:e,Caches:r,Configs:o}=function(e,t,r){s.log("â˜‘ï¸ Set Environment Variables");let{Settings:o,Caches:n,Configs:l}=function(e,t,s){t=[t].flat(1/0);let r={Settings:s?.Default?.Settings||{},Configs:s?.Default?.Configs||{},Caches:{}};switch(t.forEach(e=>{r.Settings={...r.Settings,...s?.[e]?.Settings},r.Configs={...r.Configs,...s?.[e]?.Configs}}),typeof $argument){case"string":$argument=Object.fromEntries($argument.split("&").map(e=>e.split("=",2).map(e=>e.replace(/\"/g,""))));case"object":{let e={};Object.keys($argument).forEach(t=>a.set(e,t,$argument[t])),r.Settings={...r.Settings,...e}}}let o=i.getItem(e);return o&&t.forEach(e=>{switch(typeof o?.[e]?.Settings){case"string":o[e].Settings=JSON.parse(o[e].Settings||"{}");case"object":r.Settings={...r.Settings,...o[e].Settings}}switch(typeof o?.[e]?.Caches){case"string":o[e].Caches=JSON.parse(o[e].Caches||"{}");case"object":r.Caches={...r.Caches,...o[e].Caches}}}),function e(t,s){for(let a in t){let r=t[a];t[a]="object"==typeof r&&null!==r?e(r,s):s(a,r)}return t}(r.Settings,(e,t)=>("true"===t||"false"===t?t=JSON.parse(t):"string"==typeof t&&(t=t.includes(",")?t.split(",").map(e=>c(e)):c(t)),t)),r}(e,t,r);return s.info(`typeof Settings: ${typeof o}`,`Settings: ${JSON.stringify(o,null,2)}`),s.log("âœ… Set Environment Variables"),{Settings:o,Caches:n,Configs:l}}("BiliBili","Redirect",h);switch(s.logLevel=e.LogLevel,$request.method){case"POST":case"PUT":case"PATCH":case"DELETE":switch(d){case void 0:case"application/x-www-form-urlencoded":case"text/plain":default:case"application/x-mpegURL":case"application/x-mpegurl":case"application/vnd.apple.mpegurl":case"audio/mpegurl":case"text/xml":case"text/html":case"text/plist":case"application/xml":case"application/plist":case"application/x-plist":case"text/vtt":case"application/vtt":case"text/json":case"application/json":break;case"application/protobuf":case"application/x-protobuf":case"application/vnd.google.protobuf":case"application/grpc":case"application/grpc+proto":case"application/vnd.apple.flatbuffer":case"application/octet-stream":{let e="Quantumult X"===t?new Uint8Array($request.bodyBytes??[]):$request.body??new Uint8Array;$request.body=e}}case"GET":case"HEAD":case"OPTIONS":default:switch(u.hostname){case"upos-sz-mirrorali.bilivideo.com":case"upos-sz-mirrorali02.bilivideo.com":case"upos-sz-mirroralib.bilivideo.com":case"upos-sz-mirroralio1.bilivideo.com":case"upos-sz-mirrorcos.bilivideo.com":case"upos-sz-mirrorcosb.bilivideo.com":case"upos-sz-mirrorcoso1.bilivideo.com":case"upos-sz-mirrorhw.bilivideo.com":case"upos-sz-mirrorhwb.bilivideo.com":case"upos-sz-mirrorhwo1.bilivideo.com":case"upos-sz-mirror08c.bilivideo.com":case"upos-sz-mirror08h.bilivideo.com":case"upos-sz-mirror08ct.bilivideo.com":break;case"upos-hz-mirrorakam.akamaized.net":case"upos-sz-mirrorawsov.bilivideo.com":case"upos-sz-mirroraliov.bilivideo.com":case"upos-sz-mirrorcosov.bilivideo.com":case"upos-sz-mirrorhwov.bilivideo.com":u.hostname=e.Host.OverseaVideo;break;case"upos-sz-mirroralibstar1.bilivideo.com":case"upos-sz-mirrorcosbstar1.bilivideo.com":case"upos-sz-mirrorhwbstar1.bilivideo.com":case"upos-bstar1-mirrorakam.akamaized.net":u.hostname=e.Host.BStar;break;default:switch(u.port){case"":if(!0===u.hostname.endsWith(".mcdn.bilivideo.cn"))switch(!0){case u.pathname.startsWith("/v1/resource/"):switch(u.protocol){case"http:":u.port="8000";break;case"https:":u.port="8082"}break;case u.pathname.startsWith("/upgcxcode/"):switch(u.protocol){case"http:":u.port="9102";break;case"https:":u.port="4483"}}break;case"486":{let e=u.searchParams.get("cdn"),t=u.searchParams.get("sid");e?(u.hostname=`d1--${e}.bilivideo.com`,u.port=""):t&&(u.hostname=`${t}.bilivideo.com`,u.port="");break}case"4480":u.protocol="http:",u.hostname=u.searchParams.get("xy_usource")||e.Host.PCDN,u.port="";break;case"8000":case"8082":break;case"4483":case"9102":if(u.searchParams.has("originalUrl"))break;for(let t of(u.protocol="http:",u.hostname=e.Host.MCDN,u.port="",u.pathname="",u.searchParams.keys()))u.searchParams.delete(t);u.searchParams.set("url",$request.url);break;case"9305":u.protocol="http:",u.hostname=u.PATHs.shift(),u.port="",u.pathname=u.PATHs.join("/")}}case"CONNECT":case"TRACE":}$request.headers?.Host&&($request.headers.Host=u.host),$request.headers?.[":authority"]&&($request.headers[":authority"]=u.host),$request.url=u.toString(),s.debug(`$request.url: ${$request.url}`)})().catch(e=>s.error(e)).finally(()=>{switch(typeof e){case"object":e.headers?.["Content-Encoding"]&&(e.headers["Content-Encoding"]="identity"),e.headers?.["content-encoding"]&&(e.headers["content-encoding"]="identity"),"Quantumult X"===t?(e.status||(e.status="HTTP/1.1 200 OK"),delete e.headers?.["Content-Length"],delete e.headers?.["content-length"],delete e.headers?.["Transfer-Encoding"],o(e)):o({response:e});break;case"undefined":o($request);break;default:s.error(`ä¸åˆæ³•çš„ $response ç±»å‹: ${typeof e}`),o()}})})();